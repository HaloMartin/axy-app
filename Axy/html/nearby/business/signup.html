<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>商家入驻</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script type="text/javascript" src="../../../js/common/flexible.js"></script>
		<link href="../../../css/lib/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../../css/app/app.css" />
		<style type="text/css">
			body,
			html,
			.mui-content {
				background-color: #f4f8fb;
			}
			
			ul.group {
				margin-top: 0.266666rem !important;
			}
			
			.mui-navigate-right:after,
			.mui-push-right:after {
				font-size: 15px;
			}
			/*去除ul上下横线*/
			
			ul.group:before,
			ul.group:after {
				height: 0;
			}
			
			ul.group>li.mui-table-view-cell {
				padding: 0;
				margin: 0;
			}
			/*重写li边线*/
			
			ul.group>li.mui-table-view-cell:after {
				left: 0;
				background-color: #f2f2f3;
			}
			/*重写li a高度*/
			
			ul.group>li.mui-table-view-cell>a {
				height: 1.186666rem;
				padding: 0 0 0 0.346666rem;
				margin: 0;
				position: relative;
			}
			/*左侧文字添加颜色*/
			
			ul.group>li.mui-table-view-cell .leftname {
				color: #333333;
				position: absolute;
				top: 50%;
				-webkit-transform: translateY(-50%);
				transform: translateY(-50%);
			}
			/*右侧文字*/
			
			ul.group span.mui-badge {
				right: 0.666666rem;
				color: #808080;
				background-color: transparent;
			}
			
			.app-btn-main {
				width: 92%;
				margin: 1.52rem 4% 1.44rem 4%;
				padding: .2rem 0;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav app-header">
			<a class="mui-action-back mui-pull-left app-icon-back"></a>
			<h1 class="mui-title">商家入驻</h1>
		</header>

		<div class="mui-content">

			<template v-for="g,gi in infoList">
				<ul class="mui-table-view group">
					<li class="mui-table-view-cell" v-for="o,i in g" @tap="onItemTap(gi, i, o)">
						<a class="mui-navigate-right">
							<span class="app-font-size-26 mui-badge">{{o.value}}</span>
							<span class="app-font-size-26 leftname">{{o.name}}</span>
						</a>
					</li>

				</ul>
			</template>

			<button type="button" @tap="onNextTap()" class="mui-btn app-btn-main app-font-size-36">下一步</button>
		</div>

		<script type="text/javascript" src="../../../js/common/immersed.js"></script>
		<script src="../../../js/lib/mui.min.js"></script>
		<script type="text/javascript" src="../../../js/lib/vue.min.js"></script>
		<script type="text/javascript" src="../../../js/app/app-page.js"></script>
		<script type="text/javascript">
			mui.init();
			var getInputPage = function(g, i, ex) {
					app.page.getInput(function(data) {
						data.content && (this.infoList[g][i].value = data.content);
					}.bind(this), ex);
				},
				getStoreTimePage = function(g, i, ex) {
					var that = this;
					var upload_store_time = plus.webview.getWebviewById('upload_store_time');
					if(!upload_store_time) {
						app.page.openForResultBy('upload_store_time.html', 'upload_store_time', function(data) {
							
						}, ex);
					} else {
						upload_store_time.show('pop-in');
					}
				};

			var fnArr = [
				[
					// 城市选择
					function(g, i) {
						app.page.getPosition(function(data) {
							this.infoList[g][i].value = data.city;
						}.bind(this));
					},
					// 商户名称
					getInputPage,
					// 商户地址
					function(g, i){
						app.page.getMaps(function(data) {
							//this.infoList[g][i].value = data.city;
						}.bind(this));
					},
					// 商户类型
					function(g, i) {
						app.page.getMailType(function(data) {
							this.infoList[g][i].value = data.address;
						}.bind(this));
					},
				],
				[
					// 商户电话
					getInputPage,
					// 营业时间
					getStoreTimePage,
					// 营业状态
					getStoreTimePage,
				],
				[
					// 店铺照片
					function(g, i, ex) {
						var that = this;
						var upload_store_pic = plus.webview.getWebviewById('upload_store_pic');
						if(!upload_store_pic) {
							app.page.openForResultBy('upload_store_pic.html', 'upload_store_pic', function(data) {
								that.infoList[g][i].imgList = data.imgList;
								that.infoList[g][i].value = "已选择" + data.imgList.filter(function(item) {
									return item !== "";
								}).length + "张";
							}, ex);
						} else {
							upload_store_pic.show('pop-in');
						}

					}
				],
				[
					// 商家介绍
					function(g, i, ex) {
						var that = this;
						var upload_store_info = plus.webview.getWebviewById('upload_store_info');
						if(!upload_store_info) {
							app.page.openForResultBy('upload_store_info.html', 'upload_store_info', function(data) {
								that.infoList[g][i].imgList = data.imgList;
								that.infoList[g][i].t1 = data.t1;
								that.infoList[g][i].t2 = data.t2;
								that.infoList[g][i].value = "已填写信息";
							}, ex);
						} else {
							upload_store_info.show('pop-in');
						}
					}
				]
			];

			new Vue({
				el: ".mui-content",
				data: function() {
					return {
						tapT: null,
						infoList: [
							[{
									name: "城市",
									value: "深圳",
								}, {
									name: "名称",
									value: "输入商户名称",
								},
								{
									name: "地址",
									value: "输入商户地址",

								}, {
									name: "类型",
									value: "输入商户类型",
								}
							],

							[{
								name: "商户电话",
								value: "输入商户电话",
								r: 'tel'
							}, {
								name: "营业时间",
								value: "08:00-20:00",
							}, {
								name: "营业状态",
								value: "正在营业",
							}],
							[{
								name: "店铺照片",
								imgList: ["", "", ""],
								value: "请选择"
							}],
							[{
								name: "商家介绍",
								imgList: ["", "", ""],
								t1: "",
								t2: "",
								value: "请填写"
							}]
						]
					};
				},

				methods: {
					onItemTap: function(gindex, index, o) {
						// 防抖
						if(this.tapT) {
							return;
						}
						this.tapT = setTimeout(function() {
							this.tapT = null;
						}.bind(this), 200);
						// 防抖end

						var fn = fnArr[gindex][index];
						fn && fn.call(this, gindex, index, {
							title: o.name,
							tips: o.value,
							r: o.r,
							t1: o.t1,
							t2: o.t2,
							imgList: o.imgList
						});
					},
					onNextTap: function() {
						mui.openWindow('signup_next.html', 'signup_next', {
							extras: {
								info: {
									city: this.infoList[0][0].value
								}
							}
						});
					}
				}

			});
		</script>
	</body>

</html>