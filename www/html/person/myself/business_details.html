<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script type="text/javascript" src="../../../js/common/flexible.js"></script>
		<link href="../../../css/lib/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../../css/app/app.css" />
		<style type="text/css">
			header {
				padding-left: 0.346666rem !important;
				padding-right: 0.346666rem !important;
			}
			
			header a img {
				width: 0.48rem;
			}
			
			.mui-bar-nav~.mui-content {
				padding-top: 0;
			}
			
			.mui-icon>img {
				width: 0.8rem;
			}
			
			.mui-content {
				background-color: white
			}
			
			.mui-content>img {
				width: 100%;
				height: 7.466666rem;
			}
			
			.shop_tittle {
				min-height: 1.386666rem;
				padding-left: 0.346666rem;
				padding-right: 0.346666rem;
			}
			
			.shop_tittle>img {
				float: right;
				margin: 0.24rem 0;
				width: 0.853333rem;
				height: 0.853333rem;
			}
			
			.shop_name {
				color: #333333;
				line-height: 0.666666rem;
			}
			
			.shop_position {
				color: #9F9FA0;
				line-height: 0.666666rem;
			}
			
			.shop_position>img {
				width: 0.5rem;
				margin-right: 0.346666rem;
				vertical-align: text-bottom;
			}
			
			.business_signs,
			.business_desc {
				background-color: #F4F8FB;
				color: #9F9FA0;
				line-height: 0.906666rem;
				padding: 0 0.346666rem;
			}
			
			.signs_icon {
				padding: 0.346666rem;
				display: flex;
				display: -webkit-flex;
				/*justify-content: space-between;*/
				/*align-content: center;*/
				/*background-color: red;*/
				overflow-x: scroll;
			}
			
			.signs_icon>img {
				/*display: block;*/
				min-width: 2.026666rem;
				width: 2.026666rem;
				height: 2.026666rem;
				margin-right: .4rem;
			}
			
			.business_description {
				color: #9F9FA0;
				padding: 0.346666rem;
			}
			
			.mui-bar-transparent {
				/*设置header渐变颜色 必须 rgba*/
				background-color: rgba(255, 255, 255, 0) !important;
			}
			
			#popover-menu {
				width: 3.333333rem;
				position: fixed;
				right: 0;
				border-radius: 0;
			}
			
			#popover-menu>ul {
				border-radius: 0;
			}
			
			#popover-menu:before {
				position: absolute;
				content: "";
				height: 0;
				width: 0;
				top: 0;
				right: 8px;
				left: initial;
				background-color: transparent !important;
				width: 0 !important;
				height: 0 !important;
				border-left: 12px solid transparent;
				border-right: 12px solid transparent;
				border-bottom: 12px solid rgba(255, 255, 255, 0.8);
				transform: translate(-10px, -100%);
				-webkit-transform: translate(-10px, -100%);
			}
			
			.room.mui-table-view li {
				width: 3.333333rem !important;
				height: 1.2rem;
				display: flex;
				display: -webkit-flex;
				align-items: center;
				justify-content: center;
			}
			
			.room.mui-table-view li:after {
				left: 0 !important;
			}
			
			.room.mui-table-view img {
				width: 0.773333rem;
				margin-right: 0.266666rem;
				vertical-align: middle;
			}
			
			.room.mui-table-view span {
				color: #A2ABB1;
				vertical-align: middle;
			}
			
			@media (device-height:568px) and (-webkit-min-device-pixel-ratio:2) {
				.room.mui-table-view {
					font-size: 12px !important;
				}
				[data-dpr="2"] .room.mui-table-view {
					font-size: 24px !important;
				}
				[data-dpr="3"] .room.mui-table-view {
					font-size: 36px !important;
				}
			}
			
			/*share*/
			
			#popover-share {
				bottom: 0 !important;
				width: 100%;
				padding: 1rem .75rem;
				border-radius: 0;
			}
			
			#popover-share .share-title {
				text-align: center;
				color: #a1a1a1;
			}
			
			#popover-share .share-body {}
			
			#popover-share .share-body>img {
				float: left;
				margin-top: .8rem;
				width: 25%;
				padding: 6%;
			}
			/*end share*/
		</style>
	</head>

	<body>
		<div class="root">
			<header class="mui-bar mui-bar-nav mui-bar-transparent" data-top='0' data-offset='150' data-duration='16'>
				<a class="mui-action-back mui-icon mui-pull-left">
					<img src="../../../image/nearby/business/back.png" />
				</a>
				<h1 class="mui-title"></h1>
				<a class="mui-icon mui-pull-right" @tap="mui('#popover-menu').popover('show')">
					<img src="../../../image/person/myself/more@3x.png" />
				</a>

			</header>
			
			
			<div id="popover-share" class="mui-popover app-font-size-30">
				<div class="share-title">
					快把商家分享给朋友，获取更多赞~
				</div>
				<div class="share-body">
					<img @tap="onShareTo('qq')" src="../../../image/common/login_qq.png" />
					<img @tap="onShareTo('wxhy')" src="../../../image/common/login_wechat.png" />
					<img @tap="onShareTo('wxpyq')" src="../../../image/common/pyq@3x.png" />
					<img @tap="onShareTo('sinaweibo')" src="../../../image/common/login_weibo.png" />
				</div>
			</div>

			<div id="popover-menu" class="mui-popover">
				<ul class="mui-table-view room app-font-size-28 app-color-dark">
					<li class="mui-table-view-cell" data-href="business/signup.html" @tap="onEditTap()">
						<span class="mui-icon"><img src="../../../image/person/myself/editor@3x.png"/></span>
						<span>编辑</span>
					</li>
					<li class="mui-table-view-cell" data-href="discover/discover_release.html" @tap="onShareTap()">
						<span class="mui-icon"><img src="../../../image/person/myself/share@3x.png"/></span>
						<span>分享</span>
					</li>
				</ul>
			</div>

			<div class="mui-content noImmersed">
				<img :src="data.image1" />
				<div class="shop_tittle">
					<img src="../../../image/nearby/business/phone_icon.png" />
					<div class="shop_name app-font-size-26" v-text="data.name">
					</div>
					<div class="shop_position app-font-size-26">
						<img src="../../../image/nearby/map.png" />
						<div style="display: inline;" v-text="data.address"></div>
					</div>
				</div>
				<div class="business_signs app-font-size-26">
					商家招牌
				</div>
				<div class="signs_icon">
					<template v-for="o,i in 3">
						<img :src="data['image' + (i+1)]" />
					</template>
				</div>
				<div class="business_desc app-font-size-26">
					商家介绍
				</div>
				<div class="business_description app-font-size-26">{{data.introduction}}</div>

			</div>
		</div>
		<!--沉浸式动态处理-->
		<script type="text/javascript" src="../../../js/common/immersed.js"></script>

		<!--基础配置-->
		<script type="text/javascript" src="../../../js/config.js"></script>
		<!--基础库-->
		<script type="text/javascript" src="../../../js/lib/mui.min.js"></script>
		<script type="text/javascript" src="../../../js/lib/vue.min.js"></script>
		<script type="text/javascript" src="../../../js/lib/vue-ni.js"></script>
		<!--请求相关-->
		<script type="text/javascript" src="../../../js/dal/base.js"></script>
		<script type="text/javascript" src="../../../js/dal/store.js"></script>
		<!--App相关业务逻辑-->
		<script type="text/javascript" src="../../../js/app/app.js"></script>
		<script type="text/javascript" src="../../../js/app/app-page.js" ></script>

			<script type="text/javascript" src="../../../js/lib/Rx.min.js" ></script>
		<!--<script type="text/javascript" src="../../../js/lib/md5.min.js"></script>-->
		<!--<script type="text/javascript" src="../../../js/common/imagelazyload.js"></script>-->

		<script type="text/javascript">
			mui.init();

			new Vue({
				el: '.root',
				data: function() {
					return {
						id: -1,
						data: {
							"id": -1,
							"city": "",
							"name": "",
							"address": "",
							"type": 1,
							"onlinestate": 1,
							"introduction": "",
							"image1": "",
							"image2": "",
							"image3": "",
							"longitude": 0,
							"latitude": 0,
							"distance": null
						}
					};

				},
				watch: {
					id: function() {
						this.getInfo();
					},
				},
				mounted: function(){
					mui('#popover-menu')[0].style.top = 56 + immersed + 'px';
				},
				plusReady: function() {
					this.id = this.$view.oid;
				},
				methods: {
					// 编辑
					onEditTap: function() {
						var that = this;
						app.page.openForResultBy('../../nearby/business/signup.html','business_update', function(){
							// 更新信息
							that.getInfo();
						}, {
							sourceInfo: this.data
						});
						mui('#popover-menu').popover('hide');
					},
					// 分享点击
					onShareTap: function() {
						mui('#popover-share').popover('show');
					},
					// 分享至
					onShareTo: function(type) {
						var that = this;
						var _img = that._getImg(that.data.image1, that.data.image2, that.data.image3);
						Rx.Observable
							// 压缩
							.create(function(ob) {
								plus.nativeUI.showWaiting("正在处理图片...");
								new ni.Zip().processImage(_img, 32, function(err, overImgs) {
									plus.nativeUI.closeWaiting();
									if(err) {
										return plus.nativeUI.toast(err.message);
									}
									ob.next(overImgs[0]);
								});

							})
							// 分享
							.mergeMap(function(img) {
								return Rx.Observable.create(function(ob) {
									plus.nativeUI.showWaiting("正在拉取分享...");
									setTimeout(plus.nativeUI.closeWaiting, 3e3);
									new ni.Share(type, function(err, data) {
										plus.nativeUI.closeWaiting();
										if(err) {
											if(err.code === -100 || err.code === -2) {
												err.message = "用户取消分享";
											}
											return plus.nativeUI.toast(err.message);
										}
										ob.next(data);
									}, {
										img: img, //图片地址 暂不支持网络地址 
										href: 'http://www.vihivision.com/', //分享的超链接
										title: that.data.name, //当且仅当href存在时有效
										content: that.data.introduction //当且仅当href存在时有效
									});
								});
							})
							// 回调
							.subscribe(function(data) {
								console.log(JSON.stringify(data));
							});
					},
					getInfo: function() {
						dal.store.get(this.id, function(err, data) {
							if(err) {
								return mui.toast(err.message);
							}
							console.log(JSON.stringify(data));
							this.data = data.store;
						}.bind(this));
					},
					_getImg: function(img1, img2, img3) {
						return img1 || img2 || img3;
					},
				}
			});
		</script>
	</body>

</html>