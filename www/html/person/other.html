<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script type="text/javascript" src="../../js/common/flexible.js"></script>
		<link href="../../css/lib/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/app/app.css" />
		<style type="text/css">
			header {
				padding-left: 0.346666rem !important;
				padding-right: 0.346666rem !important;
			}
			
			header a img {
				width: 0.48rem;
			}
			
			.mui-bar-nav~.mui-content {
				padding-top: 0;
			}
			
			.mui-content {
				background-color: white;
				position: relative;
			}
			
			.mui-content>img {
				width: 100%;
				height: 6.893333rem;
			}
			
			.user_icon {
				top: 1.573333rem;
			}
			
			.user_icon>img {
				width: 2rem;
				height: 2rem;
				border: 0.066666rem solid white;
				border-radius: 50%;
			}
			
			.user_icon,
			.user_name,
			.attention,
			.fans {
				position: absolute;
				left: 50%;
				transform: translateX(-50%);
				-webkit-transform: translateX(-50%);
			}
			
			.user_name {
				color: white;
				font-weight: 500;
				top: 3.893333rem;
			}
			
			.attention {
				/*float: right;*/
				top: 4.986666rem;
				/*border: 1px solid #ff3b30;*/
				border-radius: 3px;
				background-color: white;
				color: #f82746;
				text-align: center;
				min-width: 1.866666rem;
				height: 0.666666rem;
				line-height: 0.666666rem;
				font-weight: bold;
			}
			
			.attention.active {
				color: #FFFFFF;
				background-color: #F82746;
			}
			
			.fans {
				top: 6.133333rem;
				color: white;
			}
			
			.TA {
				height: 0.933333rem;
				line-height: 0.933333rem;
				color: #9F9FA0;
				background-color: #F4F8FB;
				padding-left: 0.346666rem;
			}
			
			.dynamic {
				padding: 0 0 0.346666rem 0.346666rem;
				overflow: hidden;
				background-color: white;
			}
			
			.dynamic_item {
				float: left;
				width: 2.88rem;
				margin: 0.346666rem 0.333333rem 0.08rem 0;
				font-weight: 400;
				text-align: center;
			}
			
			.dynamic_item>img {
				width: 2.88rem;
				height: 2.88rem;
			}
			
			.blur {
				-webkit-filter: blur(10px);
				filter: blur(10px);
				
				background-color: #EDEDED;
			}
		</style>
	</head>

	<body>

		<div class="wrapper">
			<header class="mui-bar mui-bar-nav app-header mui-bar-transparent">
				<a class="mui-action-back mui-pull-left app-icon-back"></a>
			</header>

			<div class="mui-content noImmersed">
				<img :data-src="userInfo.headimgurl" class="img-lazy-load blur" data-type="avastr"/>
				<div class="user_icon app-font-size-26"><img :data-src="userInfo.headimgurl" class="img-lazy-load" data-type="avastr" /></div>
				<div class="user_name app-font-size-38" style="display: inline;" v-text="userInfo.nickname"></div>
				<div class="attention app-font-size-26" :class="focus?'active':''" @tap="onFocusTap()">{{focus?'已':'+ '}}关注</div>
				<div class="fans app-font-size-26" v-text="focuscount+'人已关注'"></div>
				<div class="TA app-font-size-26">TA的动态</div>
				<div class="dynamic">
					<template v-for="o in dynamic">
						<div class="dynamic_item app-font-size-28 " @tap="onClickTap(o.id)">
							<img :src="_getImg(o.image1,o.image2,o.image3)" />
							<div class="mui-ellipsis">{{o.title}}</div>
						</div>
					</template>
				</div>
			</div>

		</div>
		<!--沉浸式动态处理-->
		<script type="text/javascript" src="../../js/common/immersed.js"></script>

		<!--基础配置-->
		<script type="text/javascript" src="../../js/config.js"></script>
		<!--基础库-->
		<script type="text/javascript" src="../../js/lib/mui.min.js"></script>
		<script type="text/javascript" src="../../js/lib/vue.min.js"></script>
		<script type="text/javascript" src="../../js/lib/vue-ni.js"></script>
		<!--请求相关-->
		<script type="text/javascript" src="../../js/dal/base.js"></script>
		<script type="text/javascript" src="../../js/dal/user.js"></script>
		<script type="text/javascript" src="../../js/dal/article.js"></script>
		<!--App相关业务逻辑-->
		<script type="text/javascript" src="../../js/app/app.js"></script>
		<script type="text/javascript" src="../../js/app/app-page.js" ></script>


		<script type="text/javascript" src="../../js/lib/md5.min.js"></script>
		<script type="text/javascript" src="../../js/common/imagelazyload.js"></script>

		<script type="text/javascript">
			mui.init();

			new Vue({
				el: '.wrapper',
				data: function() {
					return {
						img: "",
						userName: "",
						userIcon: "",
						isAttention: false,

						dynamic: [],
						//						focus: false,
						focuscount: 0,
						isfocus: 0,
						userInfo: {
							"id": 2,
							"account": "",
							"gender": "",
							"nickname": "",
							"birthday": "",
							"province": "",
							"city": "",
							"headimgurl": "",
							"qqopenid": null,
							"wxopenid": null,
							"wbopenid": null
						},
						n: 1
					};
				},
				computed: {
					focus: function() {
						return this.isfocus !== 0;
					}
				},
				plusReady: function() {
					this.uid = this.$view.uid;
					this.from = app.user.get().account || "null";
					this.getInfo();
					this.getList();
					imagelazyload();

				},
				methods: {
					getInfo: function() {
						dal.user.get(this.from, this.uid, function(err, data) {
							if(err) {
								return mui.toast(err.message);
							}
							this.isfocus = data.isfocus;
							this.focuscount = data.focuscount;
							//							alert(JSON.stringify(this.focuscount));
							this.userInfo = data.user;
							this.$nextTick(function(){
								imagelazyload();
							});
						}.bind(this));
					},
					getList: function() {
						dal.article.user.list(this.uid, this.n, function(err, data) {
							if(err) {
								return mui.toast(JSON.stringify(err));
							}
							this.dynamic = data;
							console.log(JSON.stringify(this.dynamic));
						}.bind(this), 6);
					},
					onFocusTap: function() {
						app.user.get(function(u){
							if(!u){
								return false;
							}
							
							if(this.from === this.uid) {
								return mui.toast("您不能关注自己！");
							}
							this.isfocus = +!this.isfocus;
							this.changeFocus();
						}.bind(this));
						
						
					},
					changeFocus: function() {
						var methodName = 'add';
						if(!this.focus) {
							this.focuscount--;
							methodName = 'delete';
						} else {
							this.focuscount++;
						}
						dal.user.focus[methodName](this.uid, function(err, data) {

						});
					},
					_getImg: function(img1, img2, img3) {
						return img1 || img2 || img3;
					},
					onClickTap: function(oid) {
						mui.openWindow('../nearby/discover/discover_details.html', 'discover_details', {
							extras: {
								oid: oid
							},
							createNew: true
						});
					},
				}
			});
		</script>
	</body>

</html>